<!DOCTYPE html>
<html>
<head>
  <title>Code Editor</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.css" />
</head>
<body>
  <textarea id="editor"></textarea>
  <button id="saveCode">Save and Run Tests</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.10/mode/clike/clike.js"></script>
  <script>
    const editor = CodeMirror.fromTextArea(document.getElementById('editor'), {
      mode: 'text/x-java',
      lineNumbers: true,
    });

async function getFileSHA() {
  const response = await fetch('https://api.github.com/repos/null-point-sys/spring_boot_rest_api_crud/contents/src/main/java/com/example/UserCode.java', {
    headers: {
      'Authorization': 'Bearer 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',
    },
  });
  if (response.ok) {
    const fileData = await response.json();
    return fileData.sha;
  } else if (response.status === 404) {
    return null; // El archivo no existe aÃºn
  } else {
    throw new Error('Error fetching file SHA');
  }
}

document.getElementById('saveCode').addEventListener('click', async () => {
  const code = editor.getValue();
  const sha = await getFileSHA(); // Obtener SHA del archivo actual
  
  await fetch( 'https://api.github.com/repos/null-point-sys/spring_boot_rest_api_crud/contents/src/main/java/com/example/UserCode.java', {
    method: 'PUT',
    headers: {
      'Authorization': 'Bearer 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',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      message: 'User submitted code',
      content: btoa(code), // Codificar en Base64
      sha: sha || undefined, // Solo incluir SHA si existe
    }),
  });
});

    
  </script>
</body>
</html>
